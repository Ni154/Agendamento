<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Studio • Agendamentos</title>

  <!-- CSS do projeto -->
  <link rel="stylesheet" href="/assets/css/style.css?v=4"/>
  <link rel="stylesheet" href="/assets/css/app.css?v=4"/>

  <!-- ========== SNIPPET EMBED (use igual nas demais páginas internas) ========== -->
  <script>
  /* EMBED: se abrir em iframe ou com ?embed=1, some a navegação interna
     e expanda o conteúdo para ocupar toda a área da aba. */
  (function () {
    try {
      var q = new URLSearchParams(location.search);
      var isEmbed = q.get('embed') === '1' || (window.self !== window.top);
      if (!isEmbed) return;

      document.documentElement.classList.add('is-embed');
      document.body.classList.add('is-embed');

      var s = document.createElement('style');
      s.textContent = `
        .sidebar, .sb-menu, .sb-top { display:none !important; }
        .app{ display:block !important; grid-template-columns: 1fr !important; }
        .content{ padding:24px 16px !important; min-height:100vh !important; }
        .card{ width:100% !important; max-width:none !important; }
        a{ text-decoration:none; color:inherit; }
      `;
      document.head.appendChild(s);
    } catch(e) { /* silencioso */ }
  })();
  </script>
  <!-- ========================================================================== -->

  <!-- Scripts da página -->
  <script src="/js/theme.js?v=4" defer></script>
  <script src="/js/agendamentos.js?v=1" defer></script>
</head>

<body data-brand="#B89B61" data-brand2="#E7DBBE">
  <div class="app" id="appRoot">
    <!-- ===== Sidebar interna (visível só quando abrir direto; some em embed) ===== -->
    <aside class="sidebar">
      <div class="sb-top">
        <img class="logo-img" src="/assets/img/logo.png" alt="Logo"/>
             onerror="this.onerror=null;this.src='/assets/img/logo.png.jpeg';"
             alt="Logo"/>
        <div class="brandname">Studio Priscila Santos</div>
        <button class="toggle" id="btnToggle" title="Recolher/Expandir">≡</button>
      </div>

      <nav class="sb-menu">
        <a class="sb-item" href="/dashboard.html">
          <span class="sb-ico">🏠</span><span class="sb-text">Início</span>
        </a>
        <a class="sb-item" href="/clientes.html">
          <span class="sb-ico">🧍</span><span class="sb-text">Cadastro Cliente</span>
        </a>
        <a class="sb-item" href="/produtos.html">
          <span class="sb-ico">📦</span><span class="sb-text">Cadastro Produtos</span>
        </a>
        <a class="sb-item" href="/servicos.html">
          <span class="sb-ico">💆</span><span class="sb-text">Cadastro Serviços</span>
        </a>
        <a class="sb-item active" href="/agendamentos.html">
          <span class="sb-ico">📅</span><span class="sb-text">Agendamento</span>
        </a>
        <a class="sb-item" href="/vendas.html">
          <span class="sb-ico">💰</span><span class="sb-text">Vendas</span>
        </a>
        <a class="sb-item" href="/despesas.html">
          <span class="sb-ico">💸</span><span class="sb-text">Despesas</span>
        </a>
        <a class="sb-item" href="/relatorios.html">
          <span class="sb-ico">📈</span><span class="sb-text">Relatórios</span>
        </a>
        <a class="sb-item" href="/index.html" title="Sair">
          <span class="sb-ico">🔓</span><span class="sb-text">Sair</span>
        </a>
      </nav>
    </aside>

    <!-- ===== Conteúdo ===== -->
    <main class="content">

      <!-- Novo agendamento -->
      <div class="card">
        <h2>Novo agendamento</h2>

        <form class="form" id="agendarForm" autocomplete="off">
          <div class="input">
            <label for="ag-cliente">Cliente*</label>
            <select id="ag-cliente" required></select>
          </div>

          <div class="input">
            <label for="ag-servico">Serviço*</label>
            <select id="ag-servico" required></select>
          </div>

          <div class="input">
            <label for="ag-data">Data*</label>
            <input id="ag-data" type="date" required/>
          </div>

          <div class="input">
            <label for="ag-hora">Hora*</label>
            <input id="ag-hora" type="time" required/>
          </div>

          <div class="input">
            <label for="ag-status">Status</label>
            <select id="ag-status">
              <option value="PENDENTE">Pendente</option>
              <option value="ANDAMENTO">Em andamento</option>
              <option value="FINALIZADO">Finalizado</option>
            </select>
          </div>

          <div class="input full">
            <label for="ag-obs">Observações</label>
            <textarea id="ag-obs" rows="3" placeholder="Opcional"></textarea>
          </div>

          <div class="actions full">
            <button class="btn" type="submit" id="btnAgSalvar">Salvar</button>
            <button class="btn btn-outline" type="reset">Limpar</button>
          </div>

          <div class="note full" id="ag-msg"></div>
        </form>
      </div>

      <!-- Lista do dia -->
      <div class="card" style="margin-top:16px">
        <h2>Agendamentos de hoje</h2>

        <div class="input full">
          <label for="ag-filtro">Filtro rápido</label>
          <input id="ag-filtro" type="text" placeholder="Buscar por cliente/serviço..."/>
        </div>

        <div class="table-wrap" style="margin-top:10px; overflow:auto;">
          <table class="table" id="ag-lista">
            <thead>
              <tr>
                <th>Hora</th>
                <th>Cliente</th>
                <th>Serviço</th>
                <th>Status</th>
                <th style="width:120px">Ações</th>
              </tr>
            </thead>
            <tbody><!-- preenchido via JS --></tbody>
          </table>
        </div>
      </div>

    </main>
  </div>

  <script defer>
  // Toggle da sidebar quando esta página estiver aberta sozinha (não no workspace)
  document.getElementById('btnToggle')?.addEventListener('click', ()=>{
    document.getElementById('appRoot')?.classList.toggle('collapsed');
  });

  // Se estiver em embed, força links internos a navegar com ?embed=1
  (function(){
    var q = new URLSearchParams(location.search);
    var isEmbed = q.get('embed') === '1' || (window.self !== window.top);
    if(!isEmbed) return;
    document.querySelectorAll('a[href]').forEach(a=>{
      try{
        const u = new URL(a.getAttribute('href'), location.origin);
        if (u.origin === location.origin) {
          u.searchParams.set('embed','1');
          a.setAttribute('href', u.pathname + u.search);
        }
      }catch(_){}
    });
  })();
  </script>
</body>
</html>

<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Studio • Cadastro de Cliente</title>
  <link rel="stylesheet" href="/assets/css/style.css?v=4"/>
  <link rel="stylesheet" href="/assets/css/app.css?v=4"/>

  <!-- EMBED -->
  <script>
  (function () {
    try {
      const q = new URLSearchParams(location.search);
      const isEmbed = q.get('embed') === '1' || (window.self !== window.top);
      if (!isEmbed) return;
      document.head.insertAdjacentHTML('beforeend', `
        <style>
          .sidebar,.topbar,.tabsbar{display:none!important}
          .main{margin-left:0!important}
          .content{padding:24px 16px!important;min-height:100vh!important}
        </style>`);
    } catch(e){}
  })();
  </script>
</head>
<body data-brand="#B89B61" data-brand2="#E7DBBE">
  <aside class="sidebar" id="appSidebar">
    <div class="sb-top">
      <div class="logo-img" style="background-image:url('/assets/img/logo.png')" onerror="this.style.backgroundImage='url(/assets/img/logo.png.jpeg)'"></div>
      <div class="brandname">Studio Priscila Santos</div>
      <button class="toggle" id="btnToggle">≡</button>
    </div>
    <nav class="sb-menu">
      <a class="sb-item" href="/dashboard.html"><span class="sb-ico">🏠</span><span class="sb-text">Início</span></a>
      <a class="sb-item active" href="/clientes.html"><span class="sb-ico">🧍</span><span class="sb-text">Cadastro Cliente</span></a>
      <a class="sb-item" href="/produtos.html"><span class="sb-ico">📦</span><span class="sb-text">Cadastro Produtos</span></a>
      <a class="sb-item" href="/servicos.html"><span class="sb-ico">💆</span><span class="sb-text">Cadastro Serviços</span></a>
      <a class="sb-item" href="/agendamentos.html"><span class="sb-ico">📅</span><span class="sb-text">Agendamento</span></a>
      <a class="sb-item" href="/vendas.html"><span class="sb-ico">💰</span><span class="sb-text">Vendas</span></a>
      <a class="sb-item" href="/despesas.html"><span class="sb-ico">💸</span><span class="sb-text">Despesas</span></a>
      <a class="sb-item" href="/relatorios.html"><span class="sb-ico">📈</span><span class="sb-text">Relatórios</span></a>
      <a class="sb-item" href="/index.html"><span class="sb-ico">🔓</span><span class="sb-text">Sair</span></a>
    </nav>
  </aside>

  <div class="main">
    <header class="topbar">
      <div class="topbar-inner">
        <button id="btnToggleTop" class="toggle">≡</button>
        <div class="logo"></div>
        <div class="title">Cadastro de Cliente</div>
      </div>
    </header>

    <div class="content">
      <div class="card">
        <h2>Novo cliente</h2>
        <div id="clientesLista" class="card" style="margin-top:16px"></div>
          <div class="grid-2">
            <div class="input">
              <label>Nome*</label>
              <input id="nome" required/>
            </div>
            <div class="input">
              <label>Apelido</label>
              <input id="apelido"/>
            </div>

            <div class="input">
              <label>Telefone</label>
              <input id="telefone" placeholder="(00) 0000-0000"/>
            </div>
            <div class="input">
              <label>WhatsApp</label>
              <input id="whatsapp" placeholder="(00) 00000-0000"/>
            </div>

            <div class="input">
              <label>E-mail</label>
              <input id="email" type="email" placeholder="email@exemplo.com"/>
            </div>
            <div class="input">
              <label>CPF</label>
              <input id="cpf" placeholder="000.000.000-00"/>
            </div>

            <div class="input">
              <label>Data de nascimento</label>
              <input id="nascimento" type="date"/>
            </div>
            <div class="input">
              <label>Como conheceu</label>
              <select id="origem">
                <option value="">—</option>
                <option>Indicação</option><option>Instagram</option>
                <option>Google</option><option>Outros</option>
              </select>
            </div>

            <div class="input">
              <label>CEP</label>
              <input id="cep" placeholder="00000-000"/>
            </div>
            <div class="input">
              <label>UF</label>
              <input id="uf" maxlength="2" placeholder="PE"/>
            </div>

            <div class="input">
              <label>Cidade</label>
              <input id="cidade"/>
            </div>
            <div class="input">
              <label>Bairro</label>
              <input id="bairro"/>
            </div>

            <div class="input">
              <label>Endereço</label>
              <input id="endereco" placeholder="Rua, Av..."/>
            </div>
            <div class="input">
              <label>Número</label>
              <input id="numero" />
            </div>

            <div class="input" style="grid-column:1/-1">
              <label>Complemento</label>
              <input id="complemento"/>
            </div>

            <div class="input" style="grid-column:1/-1">
              <label>Observações</label>
              <textarea id="observacoes" rows="3"></textarea>
            </div>
          </div>

          <div class="actions" style="margin-top:8px">
            <button class="btn" type="submit">Salvar cliente</button>
            <button class="btn btn-outline" type="reset">Limpar</button>
            <div id="msg" class="note"></div>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script defer>
  const $ = s => document.querySelector(s);
  function toggleSidebar(){ $('#appSidebar')?.classList.toggle('collapsed'); }
  $('#btnToggle')?.addEventListener('click', toggleSidebar);
  $('#btnToggleTop')?.addEventListener('click', toggleSidebar);

  // helper post JSON
  async function postJSON(url, body){
    const res = await fetch(url, {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(body)});
    let data=null; try{ data = await res.json(); }catch(_){}
    return {res,data};
  }

  // em embed, propaga ?embed=1 nos links
  (function(){
    const q=new URLSearchParams(location.search);
    const isEmbed = q.get('embed')==='1'||(self!==top);
    if(!isEmbed) return;
    document.querySelectorAll('.sb-menu a').forEach(a=>{
      const u=new URL(a.href,location.origin); u.searchParams.set('embed','1'); a.href=u.pathname+u.search;
    });
  })();

  $('#clientForm')?.addEventListener('submit', async (e)=>{
    e.preventDefault();
    const body = {
      nome: $('#nome').value.trim(),
      apelido: $('#apelido').value.trim(),
      telefone: $('#telefone').value.trim(),
      whatsapp: $('#whatsapp').value.trim(),
      email: $('#email').value.trim().toLowerCase(),
      cpf: $('#cpf').value.trim(),
      nascimento: $('#nascimento').value || null,
      origem: $('#origem').value || null,
      cep: $('#cep').value.trim(),
      uf: $('#uf').value.trim(),
      cidade: $('#cidade').value.trim(),
      bairro: $('#bairro').value.trim(),
      endereco: $('#endereco').value.trim(),
      numero: $('#numero').value.trim(),
      complemento: $('#complemento').value.trim(),
      observacoes: $('#observacoes').value.trim(),
    };
    const msg = $('#msg'); msg.textContent = 'Salvando...';
    try{
      const {res,data} = await postJSON('/api/clientes', body);
      if(!res.ok){ msg.textContent = (data && (data.error||data.message)) || `Erro ${res.status}`; msg.className='note error'; return; }
      msg.textContent = 'Cliente salvo com sucesso!'; msg.className='note ok';
      e.target.reset();
    }catch(err){ msg.textContent = 'Falha de rede'; msg.className='note error'; }
  });
  </script>
</body>
</html>
